ä»¥ä¸‹ã§ã¯ .NET 9 ï¼‹ Windows Forms ï¼‹ BlazorWebView ã§ã€Œæœ¬ç•ªé‹ç”¨ã‚‚æƒ³å®šã—ãŸ To-Do ç®¡ç†ã‚¢ãƒ—ãƒªã€ã‚’ä¸€æ°—é€šè²«ã§æ§‹ç¯‰ã—ã¾ã™ã€‚ã¾ãšè¦ä»¶ã‚’æ´—ã„å‡ºã—ã¦ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ±ºå®šã—ã€ãã®ã†ãˆã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã‹ã‚‰ä¸»è¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¾ã§ç¤ºã—ã¾ã™ã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æº–æ‹ ã—ã¤ã¤ã€é‹ç”¨ãƒ»ä¿å®ˆã§å•é¡Œã«ãªã‚Šã‚„ã™ã„ç‚¹ã‚’å…ˆå›ã‚Šã—ã¦è¨­è¨ˆã«åæ˜ ã—ã¾ã™ã€‚


---

1. è¦ä»¶æ•´ç†ã¨è¨­è¨ˆæ–¹é‡

1-1 å¿…é ˆæ©Ÿèƒ½ï¼ˆMVPï¼‰

1-2 å°†æ¥æ‹¡å¼µã‚’è¦‹æ®ãˆãŸéæ©Ÿèƒ½è¦ä»¶

DI ã¨ã‚µãƒ¼ãƒ“ã‚¹åˆ†é›¢ â€• ITodoRepository ã‚’æŠ½è±¡åŒ–ã—ã€å°†æ¥ DB/ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸã¸å·®ã—æ›¿ãˆå¯ 

å˜ä¸€ã‚½ãƒ¼ã‚¹ãƒ»ãƒãƒ«ãƒ UI â€• åŒã˜ Razor ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ Web/Mobile ã«æ¨ªå±•é–‹å¯èƒ½ 

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é¸å®š â€• .NET 9 ç”¨ã® Microsoft.AspNetCore.Components.WebView.WindowsForms 9.x preview ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ 



---

2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

TodoHybrid.sln
 â””â”€ TodoHybrid.WinForms          ï¼ˆWindows Forms æœ¬ä½“ï¼‰
     â”œâ”€ TodoHybrid.WinForms.csproj
     â”œâ”€ Program.cs               ï¼ˆã‚¨ãƒ³ãƒˆãƒªï¼DI æ§‹ç¯‰ï¼‰
     â”œâ”€ MainForm.cs              ï¼ˆBlazorWebView ãƒ›ã‚¹ãƒˆï¼‰
     â”œâ”€ Services\
     â”‚   â”œâ”€ ITodoRepository.cs
     â”‚   â””â”€ FileTodoRepository.cs
     â”œâ”€ wwwroot\
     â”‚   â””â”€ index.html
     â”œâ”€ _Imports.razor
     â”œâ”€ App.razor
     â””â”€ Pages\
         â””â”€ Todo.razor

> SDK ã‚’ Microsoft.NET.Sdk.Razor ã«å¤‰æ›´ã—ã€TargetFramework ã‚’ net9.0-windows ã«è¨­å®š 



NuGet ã§æ¬¡ã® 3 ã¤ã‚’è¿½åŠ ã—ã¾ã™ã€‚

<PackageReference Include="Microsoft.AspNetCore.Components.WebView.WindowsForms" Version="9.*-preview" />
<PackageReference Include="Microsoft.Web.WebView2" Version="1.0.2151.40" />
<PackageReference Include="System.Text.Json" Version="9.*" />


---

3. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

3-1 Visual Studio 2022/2025 ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

.NET 9 SDK 9.0.200 ä»¥é™ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« 

ã€ŒWindows Forms Appã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå¾Œã€NuGet è¿½åŠ ã¨ SDK åˆ‡æ›¿ã‚’å®Ÿæ–½ 


3-2 MainForm ã¨ DI

// MainForm.cs
using Microsoft.Extensions.DependencyInjection;
using Microsoft.AspNetCore.Components.WebView.WindowsForms;
using TodoHybrid.WinForms.Services;  // DI å¯¾è±¡

public partial class MainForm : Form
{
    public MainForm()
    {
        InitializeComponent();

        var services = new ServiceCollection();
        services.AddWindowsFormsBlazorWebView();        // WebView2 åˆ©ç”¨ î¨6î¨‚
        services.AddSingleton<ITodoRepository, FileTodoRepository>();
        var provider = services.BuildServiceProvider();

        var blazor = new BlazorWebView
        {
            Dock      = DockStyle.Fill,
            HostPage  = "wwwroot\\index.html",
            Services  = provider
        };
        blazor.RootComponents.Add<App>("#app");         // ãƒ«ãƒ¼ãƒˆ Razor î¨7î¨‚
        Controls.Add(blazor);
    }
}

3-3 æ°¸ç¶šåŒ–ã‚µãƒ¼ãƒ“ã‚¹

// Services/FileTodoRepository.cs
public sealed class FileTodoRepository : ITodoRepository
{
    private readonly string _file = 
        Path.Combine(Environment.GetFolderPath(
            Environment.SpecialFolder.ApplicationData),
            "TodoHybrid", "todos.json");

    private readonly List<TodoItem> _cache = [];

    public FileTodoRepository()
    {
        Directory.CreateDirectory(Path.GetDirectoryName(_file)!);
        if (File.Exists(_file))
            _cache = JsonSerializer.Deserialize<List<TodoItem>>(
                         File.ReadAllText(_file)) ?? [];
    }

    public IEnumerable<TodoItem> GetAll() => _cache;

    public void Save(TodoItem item)
    {
        if (!_cache.Contains(item)) _cache.Add(item);
        Persist();
    }

    public void Delete(Guid id)
    {
        _cache.RemoveAll(t => t.Id == id);
        Persist();
    }

    private void Persist() =>
        File.WriteAllText(_file,
            JsonSerializer.Serialize(_cache, 
                new JsonSerializerOptions { WriteIndented = true }));
}

3-4 Razor UI

<!-- Pages/Todo.razor -->
@inject ITodoRepository Repo
@page "/todo"

<PageTitle>TODO</PageTitle>

<h3 class="mb-3">ã‚¿ã‚¹ã‚¯ä¸€è¦§</h3>

<input @bind="newText" placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯..." class="form-control mb-2" />
<button class="btn btn-primary" @onclick="Add">è¿½åŠ </button>

<select class="form-select mt-3" @bind="filter">
    <option value="All">ã™ã¹ã¦</option>
    <option value="Active">æœªå®Œäº†</option>
    <option value="Done">å®Œäº†</option>
</select>

<ul class="list-group mt-3">
@foreach (var t in Filtered)
{
    <li class="list-group-item d-flex justify-content-between">
        <span class="@GetCss(t)">@t.Text (@t.Due:yyyy/MM/dd)</span>
        <span>
            <button class="btn btn-sm btn-success me-1" @onclick="() => Toggle(t)">âœ“</button>
            <button class="btn btn-sm btn-danger" @onclick="() => Delete(t.Id)">ğŸ—‘</button>
        </span>
    </li>
}
</ul>

@code {
    string newText = "";
    string filter = "All";

    IEnumerable<TodoItem> Filtered =>
        filter switch
        {
            "Active" => Repo.GetAll().Where(t => !t.Completed),
            "Done"   => Repo.GetAll().Where(t =>  t.Completed),
            _        => Repo.GetAll()
        };

    void Add()
    {
        if (string.IsNullOrWhiteSpace(newText)) return;
        Repo.Save(new TodoItem(newText) { Due = DateTimeOffset.Now.AddDays(1) });
        newText = "";
    }

    void Toggle(TodoItem t) { t.Completed = !t.Completed; Repo.Save(t); }
    void Delete(Guid id)    => Repo.Delete(id);
    string GetCss(TodoItem t) => t.Completed ? "text-decoration-line-through" : "";
}

> ãƒ•ã‚£ãƒ«ã‚¿ã‚„ãƒˆã‚°ãƒ«ãªã©ã®å…¸å‹çš„ Todo æ©Ÿèƒ½ã¯ã€Blazor Server/Telerik ã®ä¾‹ã¨åŒç­‰ 




---

4. æ·±æ˜ã‚Šãƒã‚¤ãƒ³ãƒˆ

4-1 Windows Forms â†” Blazor é€šä¿¡

blazorWebView.RootComponents.Add<Todo>("selector", parameters) ã‚’ä½¿ãˆã°åˆæœŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ³¨å…¥ãŒå¯èƒ½ 

åŒæ–¹å‘é€šä¿¡ãŒå¿…è¦ãªã‚‰ã€ã‚¤ãƒ™ãƒ³ãƒˆé›†ç´„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¾ãŸã¯ IJSRuntimeï¼‹postMessage ç›¸å½“ã§ãƒ–ãƒªãƒƒã‚¸å¯ 


4-2 UI/UX ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé¸å®š

ãƒ—ãƒ¬ãƒ¼ãƒ³ Bootstrap ã§è»½é‡ã«å§‹ã‚ã€å°†æ¥ Telerik UI ã‚„ DevExpress & SmartUI ãªã©ã«ç½®æ›ã—ã¦ã‚‚ Razor ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå±¤ã¯æ¸©å­˜ 

WPF ç‰ˆãƒ»MAUI ç‰ˆã¸ã®ç§»æ¤ã¯ BlazorWebView.Wpf/Maui ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å·®ã—æ›¿ãˆã®ã¿ 


4-3 ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢æ‹¡å¼µ

å°è¦æ¨¡ãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ« JSON ã§ååˆ†ã ãŒã€æ•°ä¸‡ä»¶è¦æ¨¡ã‚„å¤šç«¯æœ«åŒæœŸãŒå¿…è¦ã«ãªã£ãŸã‚‰ SQLite â†’ EF Core â†’ ã‚¯ãƒ©ã‚¦ãƒ‰ API ã¸æ®µéšçš„ã«ç§»è¡Œã§ãã‚‹è¨­è¨ˆã«ã—ã¦ã„ã‚‹ã€‚



---

5. ãƒ“ãƒ«ãƒ‰ & å®Ÿè¡Œæ‰‹é †

1. å¾©å…ƒ: dotnet restore


2. ãƒ“ãƒ«ãƒ‰: dotnet build -c Release


3. èµ·å‹•: dotnet run --project TodoHybrid.WinForms - or - Visual Studio â–¶ï¸ å®Ÿè¡Œ

åˆå›ã®ã¿ WebView2 ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒèµ°ã‚‹å ´åˆã‚ã‚Š 





---

6. ã¾ã¨ã‚

BlazorWebView ã§ãƒã‚¤ãƒ†ã‚£ãƒ– WinForms ã¨ Web æŠ€è¡“ã‚’çµ±åˆã—ã€C# ã®ã¿ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’è¨˜è¿°ã€‚

.NET 9 preview ã®æœ€æ–° API ã‚’åˆ©ç”¨ã—ã¦ DIãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å—ã‘æ¸¡ã—ã‚’ç°¡æ½”åŒ–ã€‚

ãƒ¬ã‚¤ãƒ¤åˆ†é›¢ ã¨ DI ã«ã‚ˆã‚Šã€JSON â†’ DB â†’ ã‚¯ãƒ©ã‚¦ãƒ‰ã¸ã‚¹ãƒ ãƒ¼ã‚ºã«ç™ºå±•å¯èƒ½ãªè¨­è¨ˆã€‚


ã“ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€èªè¨¼ï¼ˆAzure AD ãªã©ï¼‰ã‚„é€šçŸ¥ãƒˆãƒ¼ã‚¹ãƒˆã€ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ä¸¦ã¹æ›¿ãˆãªã©ã‚’è¿½åŠ ã™ã‚Œã°æ¥­å‹™ãƒ¬ãƒ™ãƒ«ã®ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¸æ‹¡å¼µã§ãã¾ã™ã€‚ç–‘å•ç‚¹ã‚„è¿½åŠ æ©Ÿèƒ½ã®ã”è¦æœ›ãŒã‚ã‚Œã°ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚

